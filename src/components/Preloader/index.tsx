import React, { useEffect, useRef, useState } from 'react';
import { gsap } from 'gsap';
import Stagger from '../Stagger';

const Preloader: React.FC = () => {
  const [progress, setProgress] = useState(0);
  const [loadingComplete, setLoadingComplete] = useState(false);
  const [isShown, setIsShown] = useState(true)

  const preloaderRef = useRef(null);

  useEffect(() => {
    // Эмуляция загрузки данных
    const timer = setInterval(() => {
      setProgress((prevProgress) => {
        const nextProgress = prevProgress + 1;
        if (nextProgress < 100) {
          return nextProgress;
        } else {
          clearInterval(timer);
          setLoadingComplete(true);
          return 100;
        }
      });
    }, 20);

    return () => clearInterval(timer);
  }, []);

  useEffect(() => {
    if (loadingComplete) {
      gsap.to(preloaderRef.current, {
        duration: 0.5,
        opacity: 0,
        onComplete: () => {
          setIsShown(false)
        }
      });
    }
  }, [loadingComplete, isShown]);

  if (!isShown) {
    return null; // Не рендерим компонент, если он должен быть скрыт
  }

  return (
    <div ref={preloaderRef} style={{ opacity: 1 }} className="fixed top-0 right-0 left-0 z-50 w-screen h-screen flex flex-col items-center justify-center bg-black text-white">
      <svg width="601" height="212" viewBox="0 0 601 212" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="601" height="212" fill="black" />
        <mask id="mask1" fill="white">
          <path d="M8.22321 42.4156H51.3328L80.9862 114.68H82.4813L112.135 42.4156H155.244V170H121.355V96.2403H120.358L91.9505 169.003H71.517L43.1096 95.7419H42.1128V170H8.22321V42.4156ZM171.66 42.4156H214.769L244.423 114.68H245.918L275.571 42.4156H318.681V170H284.791V96.2403H283.794L255.387 169.003H234.953L206.546 95.7419H205.549V170H171.66V42.4156ZM454.208 90.2597H419.072C418.823 87.3525 418.159 84.7153 417.079 82.348C416.041 79.9807 414.587 77.9457 412.718 76.2429C410.891 74.4986 408.669 73.1696 406.052 72.2559C403.436 71.3007 400.466 70.8231 397.144 70.8231C391.329 70.8231 386.408 72.2351 382.379 75.0593C378.392 77.8834 375.361 81.9327 373.284 87.2072C371.249 92.4817 370.232 98.8152 370.232 106.208C370.232 114.016 371.27 120.557 373.346 125.831C375.464 131.064 378.517 135.01 382.504 137.668C386.491 140.284 391.288 141.593 396.895 141.593C400.093 141.593 402.958 141.198 405.492 140.409C408.025 139.578 410.226 138.395 412.095 136.858C413.964 135.321 415.48 133.473 416.643 131.314C417.847 129.112 418.657 126.641 419.072 123.9L454.208 124.149C453.793 129.548 452.277 135.051 449.66 140.658C447.044 146.223 443.327 151.373 438.509 156.108C433.733 160.801 427.815 164.58 420.754 167.446C413.694 170.311 405.492 171.744 396.147 171.744C384.435 171.744 373.928 169.232 364.625 164.206C355.363 159.181 348.033 151.788 342.634 142.029C337.276 132.269 334.598 120.328 334.598 106.208C334.598 92.0041 337.339 80.043 342.821 70.3247C348.303 60.5648 355.696 53.193 364.999 48.2092C374.302 43.1839 384.684 40.6713 396.147 40.6713C404.204 40.6713 411.618 41.7719 418.387 43.973C425.157 46.1742 431.096 49.3929 436.204 53.6291C441.312 57.8237 445.424 62.9944 448.539 69.141C451.654 75.2877 453.543 82.3272 454.208 90.2597ZM587.041 42.4156V170H552.902V69.8263H509.793V170H475.654V42.4156H587.041Z" />
        </mask>
        <g mask="url(#mask1)">
          <path d="M8.22321 42.4156V37.4156H3.22321V42.4156H8.22321ZM51.3328 42.4156L55.9585 40.5175L54.6857 37.4156H51.3328V42.4156ZM80.9862 114.68L76.3605 116.578L77.6333 119.68H80.9862V114.68ZM82.4813 114.68V119.68H85.8342L87.107 116.578L82.4813 114.68ZM112.135 42.4156V37.4156H108.782L107.509 40.5175L112.135 42.4156ZM155.244 42.4156H160.244V37.4156H155.244V42.4156ZM155.244 170V175H160.244V170H155.244ZM121.355 170H116.355V175H121.355V170ZM121.355 96.2403H126.355V91.2403H121.355V96.2403ZM120.358 96.2403V91.2403H116.942L115.7 94.4219L120.358 96.2403ZM91.9505 169.003V174.003H95.366L96.6081 170.822L91.9505 169.003ZM71.517 169.003L66.8552 170.811L68.0931 174.003H71.517V169.003ZM43.1096 95.7419L47.7714 93.9342L46.5335 90.7419H43.1096V95.7419ZM42.1128 95.7419V90.7419H37.1128V95.7419H42.1128ZM42.1128 170V175H47.1128V170H42.1128ZM8.22321 170H3.22321V175H8.22321V170ZM8.22321 47.4156H51.3328V37.4156H8.22321V47.4156ZM46.7071 44.3137L76.3605 116.578L85.6119 112.782L55.9585 40.5175L46.7071 44.3137ZM80.9862 119.68H82.4813V109.68H80.9862V119.68ZM87.107 116.578L116.76 44.3137L107.509 40.5175L77.8556 112.782L87.107 116.578ZM112.135 47.4156H155.244V37.4156H112.135V47.4156ZM150.244 42.4156V170H160.244V42.4156H150.244ZM155.244 165H121.355V175H155.244V165ZM126.355 170V96.2403H116.355V170H126.355ZM121.355 91.2403H120.358V101.24H121.355V91.2403ZM115.7 94.4219L87.2929 167.185L96.6081 170.822L125.016 98.0586L115.7 94.4219ZM91.9505 164.003H71.517V174.003H91.9505V164.003ZM76.1788 167.196L47.7714 93.9342L38.4478 97.5495L66.8552 170.811L76.1788 167.196ZM43.1096 90.7419H42.1128V100.742H43.1096V90.7419ZM37.1128 95.7419V170H47.1128V95.7419H37.1128ZM42.1128 165H8.22321V175H42.1128V165ZM13.2232 170V42.4156H3.22321V170H13.2232ZM171.66 42.4156V37.4156H166.66V42.4156H171.66ZM214.769 42.4156L219.395 40.5175L218.122 37.4156H214.769V42.4156ZM244.423 114.68L239.797 116.578L241.07 119.68H244.423V114.68ZM245.918 114.68V119.68H249.271L250.543 116.578L245.918 114.68ZM275.571 42.4156V37.4156H272.218L270.945 40.5175L275.571 42.4156ZM318.681 42.4156H323.681V37.4156H318.681V42.4156ZM318.681 170V175H323.681V170H318.681ZM284.791 170H279.791V175H284.791V170ZM284.791 96.2403H289.791V91.2403H284.791V96.2403ZM283.794 96.2403V91.2403H280.379L279.137 94.4219L283.794 96.2403ZM255.387 169.003V174.003H258.802L260.044 170.822L255.387 169.003ZM234.953 169.003L230.292 170.811L231.529 174.003H234.953V169.003ZM206.546 95.7419L211.208 93.9342L209.97 90.7419H206.546V95.7419ZM205.549 95.7419V90.7419H200.549V95.7419H205.549ZM205.549 170V175H210.549V170H205.549ZM171.66 170H166.66V175H171.66V170ZM171.66 47.4156H214.769V37.4156H171.66V47.4156ZM210.143 44.3137L239.797 116.578L249.048 112.782L219.395 40.5175L210.143 44.3137ZM244.423 119.68H245.918V109.68H244.423V119.68ZM250.543 116.578L280.197 44.3137L270.945 40.5175L241.292 112.782L250.543 116.578ZM275.571 47.4156H318.681V37.4156H275.571V47.4156ZM313.681 42.4156V170H323.681V42.4156H313.681ZM318.681 165H284.791V175H318.681V165ZM289.791 170V96.2403H279.791V170H289.791ZM284.791 91.2403H283.794V101.24H284.791V91.2403ZM279.137 94.4219L250.729 167.185L260.044 170.822L288.452 98.0586L279.137 94.4219ZM255.387 164.003H234.953V174.003H255.387V164.003ZM239.615 167.196L211.208 93.9342L201.884 97.5495L230.292 170.811L239.615 167.196ZM206.546 90.7419H205.549V100.742H206.546V90.7419ZM200.549 95.7419V170H210.549V95.7419H200.549ZM205.549 165H171.66V175H205.549V165ZM176.66 170V42.4156H166.66V170H176.66ZM454.208 90.2597V95.2597H459.644L459.191 89.8424L454.208 90.2597ZM419.072 90.2597L414.091 90.6868L414.483 95.2597H419.072V90.2597ZM417.079 82.348L412.5 84.3563L412.515 84.3898L412.53 84.423L417.079 82.348ZM412.718 76.2429L409.266 79.8597L409.308 79.8998L409.351 79.9389L412.718 76.2429ZM406.052 72.2559L404.338 76.9527L404.371 76.9647L404.404 76.9763L406.052 72.2559ZM382.379 75.0593L379.509 70.9651L379.499 70.9721L379.489 70.9791L382.379 75.0593ZM373.284 87.2072L368.632 85.3755L368.625 85.3914L368.619 85.4074L373.284 87.2072ZM373.346 125.831L368.694 127.663L368.703 127.685L368.712 127.707L373.346 125.831ZM382.504 137.668L379.731 141.828L379.746 141.838L379.761 141.848L382.504 137.668ZM405.492 140.409L406.979 145.183L407.014 145.172L407.049 145.16L405.492 140.409ZM412.095 136.858L415.271 140.72L415.271 140.72L412.095 136.858ZM416.643 131.314L412.257 128.913L412.248 128.928L412.24 128.943L416.643 131.314ZM419.072 123.9L419.108 118.9L414.778 118.87L414.129 123.151L419.072 123.9ZM454.208 124.149L459.193 124.533L459.604 119.187L454.243 119.149L454.208 124.149ZM449.66 140.658L454.185 142.785L454.188 142.779L454.191 142.773L449.66 140.658ZM438.509 156.108L442.013 159.674L442.014 159.674L438.509 156.108ZM420.754 167.446L418.874 162.813L420.754 167.446ZM364.625 164.206L362.24 168.601L362.248 168.606L364.625 164.206ZM342.634 142.029L338.251 144.435L338.255 144.442L338.259 144.449L342.634 142.029ZM342.821 70.3247L347.176 72.7813L347.18 72.7733L342.821 70.3247ZM364.999 48.2092L367.36 52.6166L367.367 52.6125L367.375 52.6084L364.999 48.2092ZM418.387 43.973L419.933 39.2181L419.933 39.2181L418.387 43.973ZM436.204 53.6291L433.012 57.4779L433.022 57.4856L433.031 57.4932L436.204 53.6291ZM448.539 69.141L444.079 71.4012L444.079 71.4012L448.539 69.141ZM454.208 85.2597H419.072V95.2597H454.208V85.2597ZM424.054 89.8327C423.762 86.4241 422.972 83.22 421.628 80.273L412.53 84.423C413.345 86.2106 413.884 88.281 414.091 90.6868L424.054 89.8327ZM421.658 80.3397C420.345 77.346 418.484 74.732 416.086 72.5469L409.351 79.9389C410.69 81.1594 411.736 82.6154 412.5 84.3563L421.658 80.3397ZM416.17 72.6261C413.779 70.3434 410.924 68.6611 407.701 67.5354L404.404 76.9763C406.413 77.678 408.002 78.6537 409.266 79.8597L416.17 72.6261ZM407.767 67.5591C404.507 66.3688 400.941 65.8231 397.144 65.8231V75.8231C399.991 75.8231 402.365 76.2326 404.338 76.9527L407.767 67.5591ZM397.144 65.8231C390.494 65.8231 384.523 67.4503 379.509 70.9651L385.25 79.1534C388.293 77.02 392.165 75.8231 397.144 75.8231V65.8231ZM379.489 70.9791C374.588 74.451 371.006 79.3445 368.632 85.3755L377.936 89.0388C379.715 84.5209 382.197 81.3158 385.27 79.1394L379.489 70.9791ZM368.619 85.4074C366.306 91.4026 365.232 98.3793 365.232 106.208H375.232C375.232 99.2512 376.192 93.5607 377.949 89.007L368.619 85.4074ZM365.232 106.208C365.232 114.422 366.319 121.63 368.694 127.663L377.999 124C376.221 119.484 375.232 113.609 375.232 106.208H365.232ZM368.712 127.707C371.138 133.702 374.767 138.519 379.731 141.828L385.278 133.508C382.267 131.5 379.791 128.427 377.981 123.955L368.712 127.707ZM379.761 141.848C384.697 145.088 390.488 146.593 396.895 146.593V136.593C392.088 136.593 388.285 135.481 385.247 133.488L379.761 141.848ZM396.895 146.593C400.497 146.593 403.877 146.149 406.979 145.183L404.005 135.635C402.04 136.247 399.688 136.593 396.895 136.593V146.593ZM407.049 145.16C410.112 144.156 412.876 142.689 415.271 140.72L408.92 132.996C407.577 134.1 405.938 135.001 403.934 135.658L407.049 145.16ZM415.271 140.72C417.649 138.765 419.579 136.408 421.045 133.684L412.24 128.943C411.381 130.539 410.279 131.878 408.92 132.996L415.271 140.72ZM421.029 133.714C422.542 130.948 423.522 127.908 424.016 124.649L414.129 123.151C413.792 125.374 413.152 127.277 412.257 128.913L421.029 133.714ZM419.037 128.9L454.173 129.149L454.243 119.149L419.108 118.9L419.037 128.9ZM449.223 123.766C448.86 128.486 447.527 133.405 445.129 138.544L454.191 142.773C457.026 136.698 458.726 130.611 459.193 124.533L449.223 123.766ZM445.135 138.531C442.795 143.509 439.441 148.182 435.004 152.542L442.014 159.674C447.212 154.565 451.293 148.937 454.185 142.785L445.135 138.531ZM435.005 152.541C430.755 156.717 425.412 160.159 418.874 162.813L422.635 172.079C430.218 169.001 436.711 164.884 442.013 159.674L435.005 152.541ZM418.874 162.813C412.53 165.388 404.989 166.744 396.147 166.744V176.744C405.995 176.744 414.859 175.235 422.635 172.079L418.874 162.813ZM396.147 166.744C385.174 166.744 375.498 164.397 367.001 159.807L362.248 168.606C372.358 174.066 383.697 176.744 396.147 176.744V166.744ZM367.009 159.812C358.636 155.268 351.975 148.585 347.009 139.608L338.259 144.449C344.091 154.992 352.09 163.094 362.24 168.601L367.009 159.812ZM347.017 139.623C342.159 130.772 339.598 119.708 339.598 106.208H329.598C329.598 120.949 332.394 133.765 338.251 144.435L347.017 139.623ZM339.598 106.208C339.598 92.6345 342.217 81.5721 347.176 72.7813L338.466 67.8681C332.461 78.514 329.598 91.3736 329.598 106.208H339.598ZM347.18 72.7733C352.226 63.7905 358.947 57.1232 367.36 52.6166L362.637 43.8018C352.444 49.2627 344.38 57.3391 338.461 67.876L347.18 72.7733ZM367.375 52.6084C375.887 48.0101 385.443 45.6713 396.147 45.6713V35.6713C383.926 35.6713 372.716 38.3577 362.622 43.81L367.375 52.6084ZM396.147 45.6713C403.747 45.6713 410.632 46.709 416.841 48.728L419.933 39.2181C412.603 36.8347 404.661 35.6713 396.147 35.6713V45.6713ZM416.841 48.728C423.054 50.7481 428.425 53.6735 433.012 57.4779L439.396 49.7803C433.767 45.1122 427.26 41.6003 419.933 39.2181L416.841 48.728ZM433.031 57.4932C437.581 61.2295 441.264 65.8458 444.079 71.4012L452.999 66.8809C449.584 60.143 445.044 54.418 439.377 49.7649L433.031 57.4932ZM444.079 71.4012C446.861 76.8909 448.606 83.2883 449.225 90.6771L459.191 89.8424C458.48 81.3662 456.447 73.6844 452.999 66.8809L444.079 71.4012ZM587.041 42.4156H592.041V37.4156H587.041V42.4156ZM587.041 170V175H592.041V170H587.041ZM552.902 170H547.902V175H552.902V170ZM552.902 69.8263H557.902V64.8263H552.902V69.8263ZM509.793 69.8263V64.8263H504.793V69.8263H509.793ZM509.793 170V175H514.793V170H509.793ZM475.654 170H470.654V175H475.654V170ZM475.654 42.4156V37.4156H470.654V42.4156H475.654ZM582.041 42.4156V170H592.041V42.4156H582.041ZM587.041 165H552.902V175H587.041V165ZM557.902 170V69.8263H547.902V170H557.902ZM552.902 64.8263H509.793V74.8263H552.902V64.8263ZM504.793 69.8263V170H514.793V69.8263H504.793ZM509.793 165H475.654V175H509.793V165ZM480.654 170V42.4156H470.654V170H480.654ZM475.654 47.4156H587.041V37.4156H475.654V47.4156Z"
          fill="white" mask="url(#mask1)" />
          <rect id="loader" x="-100%" y="0" width="100%" height="100%" fill="#fff" style={{transform:` translateX(${progress}%)`}}></rect>
        </g>
      </svg>
      <h2 className="text-lg mt-4 text-gray-400">Загрузка <span className='text-gray-200 font-mono'>{progress}%</span></h2>
      <Stagger />
    </div>
  );
};

export default Preloader;
